---
title: "Supplementary Material"
output:
  pdf_document:
    number_sections: true
    toc: true
    toc_depth: 2
---

```{r, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

<!-- # loading packages -->
```{r}
library(tidyverse)
library(bootnet)
library(kableExtra)
```

<!-- # loading data labels -->
```{r}
variables <- as.data.frame(readxl::read_xlsx("../data/variablebook.xlsx")) %>% 
  select("label", "variablename", "variable_description_short", "variable_description_clean")
```

\newpage
# Appendix 1: Preliminary fitting of 57-node network model

<!-- # loading data -->
```{r}
networkdata_allitems_sg <- read.csv("../data/networkdata_allitems_sg.csv")
```

## Estimated network
```{r}
# defining node labels for graph
nodelabels_57 <- data.frame(variablename = colnames(networkdata_allitems_sg)) %>% 
  left_join(variables, by = "variablename") %>%
  select(label)

#estimating network
network_57 <- estimateNetwork(networkdata_allitems_sg,
                             default = "EBICglasso",
                             corMethod = "spearman",
                             labels = nodelabels_57$label,
                             missing = "pairwise",
                             sampleSize = "pairwise_average",
                             tuning = 0.5)

# custom function for defining legend vectors
# DO NOT use if there is only one element
# var_start argument should be argument for dplyr::starts_with
def_legend <- function(data, var_start){
  
  data %>% 
    select(starts_with(var_start)) %>% 
    colnames() %>%  
    match(colnames(data))
}

# defining grouping for legend
group_subscale_57 <- list("GAD" = def_legend(networkdata_allitems_sg,"gad"),
                       "PHQ-9" = def_legend(networkdata_allitems_sg,"phq"),
                       "SMPD" = def_legend(networkdata_allitems_sg,"smpd"),
                       "SMSAD" = def_legend(networkdata_allitems_sg,"smsp"),
                       "DOCS" = def_legend(networkdata_allitems_sg,"docs"),
                       "TPESS" = c(which(colnames(networkdata_allitems_sg) == "tpess")))

# printing plot
plot_57 <- plot(network_57,
     groups = group_subscale_57,
     layout = "spring",
     cut = 0,
     palette = "pastel",
     vsize = 4,
     labels = nodelabels_57$label,
     label.cex = 1.35,
     border.width = 0.75,
     legend.cex = 0.5)

```

\newpage
## Item content
```{r}
data.frame(variablename = colnames(networkdata_allitems_sg)) %>% 
  left_join(variables, by = "variablename") %>% 
  select(label, variable_description_short) %>% kbl(format = "latex", col.names = c("Node Label", "Description"), caption = "Item content for 57-node network", booktabs = TRUE, longtable = TRUE)  %>%
  pack_rows("GAD-7", 1, 7) %>% 
  pack_rows("PHQ-9", 8, 16) %>% 
  pack_rows("SMPD", 17, 26) %>% 
  pack_rows("SMSAD", 27, 36) %>% 
  pack_rows("DOCS", 37, 56) %>% 
  pack_rows("TPESS", 57, 57) %>% 
  column_spec(1, width = "10em") %>%
  column_spec(2, width = "30em") %>% 
  footnote(
    general_title = "Note.",
    general = "GAD-7 = Generalized Anxiety Disorder-7; PHQ-9 = Patient Health Questionnaire-9; SMPD = Severity Measure for Panic Disorder-Adult; SMSAD = Severity Measure for Social Anxiety Disorder-Adult; DOCS = Dimensional Obsessive-Compulsive Scale; TPESS = Transdiagnostic Processes of Emotional Symptoms Scale; Item labels for PHQ-9, GAD-7, and DOCS adapted from Hsu et al. (2022), Mossman et al. (2017), and Abramowitz et al. (2010) respectively.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE)
```

\newpage
# Appendix 2: Distribution of responses to PHQ-9, GAD-7, SMPD, and SMSAD items

The size of the circles in each plot reflects the proportion of the sample that selected the corresponding item response.

<!-- # importing data-->
```{r}
networkdata_sg <- read.csv("../data/networkdata_sg.csv")
```

## Patient Health Questionnaire-9 (PHQ-9)
```{r}
phq <- networkdata_sg[which(colnames(networkdata_sg) == "phq1"):which(colnames(networkdata_sg) == "phq9")] %>% 
  pivot_longer(names_to = "item",
               values_to = "response",
               cols = everything()) %>%
  left_join(variables, by = c("item" = "variablename"))

ggplot(phq, aes(x = response, y = variable_description_short)) +
  geom_count(aes(size = after_stat(prop)), na.rm = TRUE) +
  scale_size_area(max_size = 10) +
  labs(x = "Response", y = "Item") +
  theme_light() +
  theme(legend.position = "none", axis.title.y = element_blank())
```

## Generalized Anxiety Disorder-7 (GAD-7)
```{r}
gad <- networkdata_sg[which(colnames(networkdata_sg) == "gad1"):which(colnames(networkdata_sg) == "gad7")] %>% 
  pivot_longer(names_to = "item",
               values_to = "response",
               cols = everything()) %>%
  left_join(variables, by = c("item" = "variablename"))

ggplot(gad, aes(x = response, y = variable_description_short)) +
  geom_count(aes(size = after_stat(prop)), na.rm = TRUE) +
  scale_size_area(max_size = 10) +
  labs(x = "Response", y = "Item") +
  theme_light() +
  theme(legend.position = "none", axis.title.y = element_blank())
```

## Severity Measure for Panic Disorder-Adult (SMPD)
```{r}
smpd <- networkdata_sg[which(colnames(networkdata_sg) == "smpd1"):which(colnames(networkdata_sg) == "smpd10")] %>% 
  pivot_longer(names_to = "item",
               values_to = "response",
               cols = everything()) %>%
  left_join(variables, by = c("item" = "variablename"))

ggplot(smpd, aes(x = response, y = variable_description_short)) +
  geom_count(aes(size = after_stat(prop)), na.rm = TRUE) +
  scale_size_area(max_size = 10) +
  labs(x = "Response", y = "Item") +
  theme_light() +
  theme(legend.position = "none", axis.title.y = element_blank())
```

## Severity Measure for Social Anxiety Disorder-Adult (SMSAD)
```{r}
smsad <- networkdata_sg[which(colnames(networkdata_sg) == "smsp1"):which(colnames(networkdata_sg) == "smsp10")] %>% 
  pivot_longer(names_to = "item",
               values_to = "response",
               cols = everything()) %>%
  left_join(variables, by = c("item" = "variablename"))

ggplot(smsad, aes(x = response, y = variable_description_short)) +
  geom_count(aes(size = after_stat(prop)), na.rm = TRUE) +
  scale_size_area(max_size = 10) +
  labs(x = "Response", y = "Item") +
  theme_light() +
  theme(legend.position = "none", axis.title.y = element_blank())
```

\newpage
# Appendix 3: Robustness Analysis (Bootstrapped CIs for Edge Weights)
```{r}
# generating non-parametric bootstraps samples of network_sg
# computationally intensive; code below was saved to a .rds file, to be loaded with readRDS 

#nonparboot <- bootnet(network_sg, nBoots = 1000, nCores = 8)
#saveRDS(nonparboot, file = "./rds/nonparboot.rds")
nonparboot <- readRDS(file = "./rds/nonparboot.rds")
```

```{r, fig.dim = c(8, 10)}
#plotting bootstrapped CIs for edge weights
plot(nonparboot, order = "sample", labels = FALSE, areaAlpha = 0.4)
```